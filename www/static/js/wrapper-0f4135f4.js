var se=Object.defineProperty,ae=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var I=(e,t,n)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))de.call(t,n)&&I(e,n,t[n]);if(W)for(var n of W(t))le.call(t,n)&&I(e,n,t[n]);return e},P=(e,t)=>ae(e,ce(t));var E=(e,t,n)=>new Promise((o,i)=>{var s=c=>{try{l(n.next(c))}catch(d){i(d)}},r=c=>{try{l(n.throw(c))}catch(d){i(d)}},l=c=>c.done?o(c.value):Promise.resolve(c.value).then(s,r);l((n=n.apply(e,t)).next())});import{g as G}from"./storage-9b9506ad.js";import{az as m,aH as he,j as L,d as F,o as w,m as p,A,ad as O,f as a,aI as V,aJ as S,aK as k,aL as q,aM as U,c as y,aN as j,aO as K,L as X,F as Y,a5 as R,x as J,aa as $,z as Q,v,aP as f,a6 as C,e as N,aQ as H,aR as ue,S as we}from"./index.js";import{u as Z,c as pe,F as ge,C as z}from"./chartEditStore-512dd188.js";import{t as x,F as ve,u as fe,f as ye}from"./index-82f3faec.js";import"./plugin-3f5f1424.js";import"./icon-f895716a.js";import"./chartLayoutStore-4baab7c4.js";import"./tables_list-16bd57ab.js";/* empty css                                                                */import"./SettingItemBox-0b7490e2.js";import"./CollapseItem-818c6947.js";import"./useTargetData.hook-644fac7b.js";const _e=(e,t,n,o)=>{const i=e,s=t,r={width:1,height:1},l=parseFloat((i/s).toFixed(5)),c=()=>{const b=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(b>l?(r.width=parseFloat((window.innerHeight*l/i).toFixed(5)),r.height=parseFloat((window.innerHeight/s).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`):(r.height=parseFloat((window.innerWidth/l/s).toFixed(5)),r.width=parseFloat((window.innerWidth/i).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`),o&&o(r))},d=x(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},me=(e,t,n,o)=>{const i=e,s=t,r={width:1,height:1},l=parseFloat((i/s).toFixed(5)),c=()=>{n&&(r.height=parseFloat((window.innerWidth/l/s).toFixed(5)),r.width=parseFloat((window.innerWidth/i).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`,o&&o(r))},d=x(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},Ce=(e,t,n,o)=>{const i=e,s=t,r={height:1,width:1},l=parseFloat((i/s).toFixed(5)),c=()=>{n&&(r.width=parseFloat((window.innerHeight*l/i).toFixed(5)),r.height=parseFloat((window.innerHeight/s).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`,o&&o(r))},d=x(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},Se=(e,t,n,o)=>{const i={width:1,height:1},s=()=>{n&&(i.width=parseFloat((window.innerWidth/e).toFixed(5)),i.height=parseFloat((window.innerHeight/t).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,o&&o(i))},r=x(()=>{s()},200);return{calcRate:s,windowResize:()=>{window.addEventListener("resize",r)},unWindowResize:()=>{window.removeEventListener("resize",r)}}},ee={},D={echarts:he},te=e=>{if(!e.events)return{};const t={};for(const i in e.events.baseEvent){const s=e.events.baseEvent[i];s&&(t[i]=Re(s))}const n=e.events.advancedEvents||{},o={[m.VNODE_BEFORE_MOUNT](i){ee[e.id]=i.component;const s=(n[m.VNODE_BEFORE_MOUNT]||"").trim();M(s,i)},[m.VNODE_MOUNTED](i){const s=(n[m.VNODE_MOUNTED]||"").trim();M(s,i)}};return u(u({},t),o)};function Re(e){try{return new Function(`
      return (
        async function(mouseEvent){
          ${e}
        }
      )`)()}catch(t){console.error(t)}}function M(e,t){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(D).join()}} = node_modules;
          ${e}
        }
      )`)().bind(t==null?void 0:t.component)(t,ee,D)}catch(n){console.error(n)}}const ne=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),Fe=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),xe=(e,t,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h-t:e.h-t}px`}:{},oe=e=>({display:e.hide?"none":"block"}),ie=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},Ee=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return u({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},t)};const ze=F({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(w(!0),p(Y,null,A(e.groupData.groupList,o=>(w(),p("div",{class:O(["chart-item",a(V)(o.styles.animations)]),key:o.id,style:S(u(u(u(u(u(u({},a(ne)(o.attr,e.groupIndex)),a(k)(o.styles)),a(q)(o.styles)),a(oe)(o.status)),a(ie)(o.preview)),a(U)(o.styles)))},[(w(),y(X(o.chartConfig.chartKey),j({id:o.id,chartConfig:o,themeSetting:e.themeSetting,themeColor:e.themeColor,style:u({},a(Fe)(o.attr))},K(a(te)(o))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var $e=L(ze,[["__scopeId","data-v-3933053a"]]);const Le=F({__name:"index",setup(e){const{initDataPond:t,clearMittDataPondMap:n}=fe(),o=Z(),i=c=>{var d;return!!((d=c.chartConfig.filters)!=null&&d.length)},s=c=>{var T;const d=(T=c.chartConfig.filters)==null?void 0:T.map(_=>_.type==ge.DATE&&_.from!="query"?221:450);if(!(d!=null&&d.length))return 0;const h=d==null?void 0:d.reduce((_,re)=>_+re+8),g=h?Math.ceil(h/c.attr.w):0;return g*24+(g-1)*8+16},r=R(()=>o.editCanvasConfig.chartThemeSetting),l=R(()=>{const c=o.editCanvasConfig.chartThemeColor;return pe[c]});return n(),J(()=>{t(o.requestGlobalConfig)}),(c,d)=>(w(!0),p(Y,null,A(a(o).componentList,(h,g)=>(w(),p("div",{key:h.id,class:"chart-item",style:S(u(u(u(u(u(u({},a(ne)(h.attr,g)),a(k)(h.styles)),a(q)(h.styles)),a(oe)(h.status)),a(ie)(h.preview)),a(U)(h.styles)))},[i(h)?(w(),y(a(ve),{key:0,class:"filter-content",componentIdx:h.id,attr:h.attr,filters:h.chartConfig.filters,type:h.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):$("",!0),Q("div",{class:O(a(V)(h.styles.animations))},[h.isGroup?(w(),y(a($e),{key:0,groupData:h,groupIndex:g,themeSetting:a(r),themeColor:a(l)},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(w(),y(X(h.chartConfig.chartKey),j({key:1,id:h.id,chartConfig:h,themeSetting:a(r),themeColor:a(l),style:u({},a(xe)(h.attr,s(h)))},K(a(te)(h))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],2)],4))),128))}});var B=L(Le,[["__scopeId","data-v-3c1d243a"]]);const Oe=e=>{const t=v(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const o=i=>{window.$vue.component(i.chartConfig.chartKey)||window.$vue.component(i.chartConfig.chartKey,ye(i.chartConfig))};e.componentList.forEach(i=>E(void 0,null,function*(){i.isGroup?i.groupList.forEach(s=>{o(s)}):o(i)})),t.value=!0}},200);return{show:t}},ke=e=>{const t=v(),n=v(),o=v(e.editCanvasConfig.width),i=v(e.editCanvasConfig.height);return J(()=>{switch(e.editCanvasConfig.previewScaleType){case f.FIT:(()=>{const{calcRate:s,windowResize:r,unWindowResize:l}=_e(o.value,i.value,n.value);s(),r(),C(()=>{l()})})();break;case f.SCROLL_Y:(()=>{const{calcRate:s,windowResize:r,unWindowResize:l}=me(o.value,i.value,n.value,c=>{const d=t.value;d.style.width=`${o.value*c.width}px`,d.style.height=`${i.value*c.height}px`});s(),r(),C(()=>{l()})})();break;case f.SCROLL_X:(()=>{const{calcRate:s,windowResize:r,unWindowResize:l}=Ce(o.value,i.value,n.value,c=>{const d=t.value;d.style.width=`${o.value*c.width}px`,d.style.height=`${i.value*c.height}px`});s(),r(),C(()=>{l()})})();break;case f.FULL:(()=>{const{calcRate:s,windowResize:r,unWindowResize:l}=Se(o.value,i.value,n.value);s(),r(),C(()=>{l()})})();break}}),{entityRef:t,previewRef:n}},be=e=>{const t=Z();t.requestGlobalConfig=e[z.REQUEST_GLOBAL_CONFIG],t.editCanvasConfig=e[z.EDIT_CANVAS_CONFIG],t.componentList=e[z.COMPONENT_LIST]};const Te=F({__name:"index",setup(e){let t=G();const n=R(()=>u(u({},Ee(t.editCanvasConfig)),k(t.editCanvasConfig))),o=R(()=>{const l=t.editCanvasConfig.previewScaleType;return l===f.SCROLL_Y||l===f.SCROLL_X});be(t);const{entityRef:i,previewRef:s}=ke(t),{show:r}=Oe(t);return(l,c)=>(w(),p("div",{class:O(`go-preview ${a(t).editCanvasConfig.previewScaleType}`)},[a(o)?(w(),p("div",{key:0,ref_key:"entityRef",ref:i,class:"go-preview-entity"},[Q("div",{ref_key:"previewRef",ref:s,class:"go-preview-scale"},[a(r)?(w(),p("div",{key:0,style:S(a(n))},[N(a(B))],4)):$("",!0)],512)],512)):(w(),p("div",{key:1,ref_key:"previewRef",ref:s,class:"go-preview-scale"},[a(r)?(w(),p("div",{key:0,style:S(a(n))},[N(a(B))],4)):$("",!0)],512))],2))}});var We=L(Te,[["__scopeId","data-v-21ad7af6"]]);const Ke=F({__name:"wrapper",setup(e){let t=v(Date.now());return[H.JSON,H.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,o=>E(this,null,function*(){const i=yield G();ue(we.GO_CHART_STORAGE_LIST,[P(u({},o.detail),{id:i.id})]),t.value=Date.now()}))}),(n,o)=>(w(),y(We,{key:a(t)}))}});export{Ke as default};
